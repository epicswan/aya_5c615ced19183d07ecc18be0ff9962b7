!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("react"),require("JSONSchemaForm"),require("axios"),require("UtilsRcpt"),require("SectionRcpt"),require("BtnModeRcpt")):"function"==typeof define&&define.amd?define(["react","JSONSchemaForm","axios","UtilsRcpt","SectionRcpt","BtnModeRcpt"],t):"object"==typeof exports?exports.LoginUserRcpt=t(require("react"),require("JSONSchemaForm"),require("axios"),require("UtilsRcpt"),require("SectionRcpt"),require("BtnModeRcpt")):e.LoginUserRcpt=t(e.React,e.JSONSchemaForm,e.axios,e.UtilsRcpt,e.SectionRcpt,e.BtnModeRcpt)}("undefined"!=typeof self?self:this,function(e,t,n,a,r,o){return function(e){function t(a){if(n[a])return n[a].exports;var r=n[a]={i:a,l:!1,exports:{}};return e[a].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,a){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:a})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/dist/",t(t.s=0)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(1),r=function(e){return e&&e.__esModule?e:{default:e}}(a);t.default=r.default},function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),l=n(2),u=a(l),d=n(3),c=a(d),f=n(4),p=a(f),m=n(5),h=a(m),g=n(6),v=a(g),w=n(7),b=a(w);n(8);var y,E=(p.default.CancelToken,h.default._store.getEnv()),S=E.scheme,P=E.domain,k=E.subdomain,F=E.apiProd,x=E.domainApi,_=F?k:"membership",R=(S+"://"+_+"."+(F?x:P)).replace("__API__","membership"),N=function(e){return console.log.bind(console,e)},C=function(e){function t(e){r(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.memberModule=h.default._store.getUidSite("membership"),n.state={schema1:n.props.loginForm.schema,schema2:n.props.registerForm.schema,schema3:n.props.forgetPwdForm.schema,schema4:n.props.newPwdForm.schema,uid:n.memberModule.uid,loginForm:"loginForm"===e.startOn,forgetPwdForm:!1,showInfoForgetPwd:!1,showNewPwdForm:"showNewPwdForm"===e.startOn,pwdHasChanged:!1,error:null,bearer:{},isLoaded:!1,pathSaveLogin:R+"/login_",pathSaveRegister:R+"/register_",pathForgetPwd:R+"/resetting/send-email",pathNewPwd:R+"/resetting/reset/",cancelToken:null,successInfoForgetPwd:!1,pendingRequest:!1},n.onIdentificationSuccess=n.onIdentificationSuccess.bind(n),n.onResponseForgetPwd=n.onResponseForgetPwd.bind(n),n.doLoginValidation=n.doLoginValidation.bind(n),n.doRegisterValidation=n.doRegisterValidation.bind(n),n.doForgetPwdValidation=n.doForgetPwdValidation.bind(n),n.doChangePwdValidation=n.doChangePwdValidation.bind(n),n.flipMode=n.flipMode.bind(n),n}return i(t,e),s(t,[{key:"doRegisterValidation",value:function(e,t){var n=this;this.validate(e,this.state.pathSaveRegister,function(e,t){n.onIdentificationSuccess(e,t)})}},{key:"doLoginValidation",value:function(e){var t=this;this.validate(e,this.state.pathSaveLogin,function(e,n){t.onIdentificationSuccess(e,n)})}},{key:"doForgetPwdValidation",value:function(e){var t=this,n=function(e,n){t.onResponseForgetPwd(e,n)};this.validate(e,this.state.pathForgetPwd,n,n)}},{key:"doChangePwdValidation",value:function(e){this.validateNewPwd(e)}},{key:"CustomFieldTemplate",value:function(e){var t=e.id,n=e.classNames,a=e.label,r=e.help,o=e.required,i=e.description,s=(e.errors,e.children);return u.default.createElement("div",{className:n},u.default.createElement("label",{htmlFor:t},a,o?"*":null),i,s,r)}},{key:"validateDoublePwd",value:function(e,t){return""!==e.password&&e.password!==e.repeat_password&&t.repeat_password.addError("Passwords don't match"),t}},{key:"validate",value:function(e,t,n,a){var r=this;this.state.pendingRequest||this.setState({pendingRequest:!0},function(){var o={data:e.formData};o=t.includes("resetting/send-email")?{username:e.formData.email,domain:window.location.hostname}:{_username:e.formData.email,_password:e.formData.password,_uid:r.state.uid||r.props.uid,_channel:2},p.default.post(t,o,{headers:{"Content-Type":"application/json"}}).then(function(e){r.setState({pendingRequest:!1,showInfoForgetPwd:!0},function(){"function"==typeof n&&n(e.data,o)})}).catch(function(e){r.setState({pendingRequest:!1},function(){"function"==typeof a?a(e.response.data,o):r.onIdentificationFail(e)})})})}},{key:"validateNewPwd",value:function(e){var t=this;this.state.pendingRequest||this.setState({pendingRequest:!0},function(){var n=R+"/resetting/reset/"+t.state.token,a=new FormData;a.append("fos_user_resetting_form[plainPassword][first]",e.formData.password),a.append("fos_user_resetting_form[plainPassword][second]",e.formData.repeat_password),p.default.post(n,a).then(function(e){e.data.status?t.setState({pendingRequest:!1,pwdHasChanged:!0}):t.setState({pendingRequest:!1})}).catch(function(e){t.setState({pendingRequest:!1},function(){t.onIdentificationFail(e)})})})}},{key:"flipMode",value:function(e){e.preventDefault(),this.setState({loginForm:!this.state.loginForm,forgetPwdForm:!1})}},{key:"componentDidMount",value:function(){var e=this.getToken("urlSearchParams");this.setState({token:e})}},{key:"gup",value:function(e,t){t||(t=location.href),e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var n="[\\?&]"+e+"=([^&#]*)",a=new RegExp(n),r=a.exec(t);return null==r?null:r[1]}},{key:"componentWillUnmount",value:function(){y&&"function"==typeof y&&y()}},{key:"logout",value:function(){localStorage&&localStorage.removeItem("currentUser")}},{key:"forgetPwd",value:function(){this.setState({forgetPwdForm:!0})}},{key:"parseJwt",value:function(e){var t=e.split(".")[1],n=t.replace("-","+").replace("_","/");return JSON.parse(window.atob(n))}},{key:"onResponseForgetPwd",value:function(e,t){this.setState({showInfoForgetPwd:!0,successInfoForgetPwd:e.status})}},{key:"onIdentificationSuccess",value:function(e,t){var n=this;localStorage.setItem("currentUser",e.token);JSON.stringify({token:e.token});t&&t._username&&JSON.stringify({token:e.token,email:t._username}),this.parseJwt(e.token).username&&setTimeout(function(){n.props.onLogin()},300)}},{key:"onIdentificationFail",value:function(e){alert(e.response&&e.response.data&&e.response.data.error?e.response.data.error:"Vérifier vos accès.")}},{key:"getToken",value:function(e){if("splitPath"===e)return location.pathname.split("/")[2];if("urlSearchParams"===e){var t=new URL(location.href);return new URLSearchParams(t.search).get("token")}}},{key:"backToLogin",value:function(){this.setState({loginForm:!0,forgetPwdForm:!1,showInfoForgetPwd:!1,pwdHasChanged:!1,showNewPwdForm:!1,tokenNewPwd:""})}},{key:"renderRegister",value:function(){var e=this,t=this.props.uiSchema,n=this.state,a=n.schema2,r=(n.loginForm,n.pendingRequest),o=this.doRegisterValidation,i=this.CustomFieldTemplate;this.validateDoublePwd;return u.default.createElement("div",null,u.default.createElement("div",{className:"login__header"},u.default.createElement("div",{className:"h1"},"S'inscrire"),u.default.createElement("div",{className:"login__header-label"},"Vous avez déjà un compte ?"," ",u.default.createElement("span",{onClick:function(t){return e.flipMode(t)}},u.default.createElement("a",{href:"/"},"Se connecter")))),u.default.createElement(c.default,{schema:a,FieldTemplate:i,onError:N("errors"),onSubmit:o,showErrorList:!1,liveValidate:!0,uiSchema:t},u.default.createElement("div",{className:"text-center"},r&&u.default.createElement("i",{className:"fas fa-spinner fa-pulse"})||u.default.createElement(b.default,{cta:{txt:"S'inscrire",class:"btn-primary btn-block px-4",link:"/",visible:!0,tpl:"BtnBootstrapSubmit"}}))))}},{key:"renderLogin",value:function(){var e=this,t=this.props.uiSchema,n=this.state,a=n.schema1,r=(n.loginForm,n.pendingRequest),o=this.doLoginValidation,i=this.CustomFieldTemplate;return u.default.createElement("div",null,u.default.createElement("div",{className:"login__header"},u.default.createElement("div",{className:"h1"},"Se connecter"),u.default.createElement("div",{className:"login__header-label"},"Vous n'avez pas encore de compte ?"," ",u.default.createElement("span",{onClick:function(t){return e.flipMode(t)}},u.default.createElement("a",{href:"/"},"S'inscrire")))),u.default.createElement(c.default,{schema:a,FieldTemplate:i,onError:N("errors"),onSubmit:o,showErrorList:!1,liveValidate:!0,uiSchema:t},u.default.createElement("div",null,u.default.createElement("div",{className:"text-right my-3"},u.default.createElement("button",{type:"button",onClick:function(){return e.forgetPwd()},className:"btn btn-link px-0"},"Mot de passe oublié ?")),u.default.createElement("div",{className:"text-center"},r&&u.default.createElement("i",{className:"fas fa-spinner fa-pulse"})||u.default.createElement(b.default,{cta:{txt:"Se connecter",class:"btn-primary btn-block px-4",link:"/",visible:!0,tpl:"BtnBootstrapSubmit"}})))))}},{key:"renderForgetPwd",value:function(){var e=this,t=this.props.uiSchema,n=this.state,a=n.schema3,r=n.pendingRequest,o=this.doForgetPwdValidation,i=this.CustomFieldTemplate;return this.logout(),u.default.createElement("div",null,u.default.createElement("div",{className:"login__header"},"Mot de passe oublié"),u.default.createElement(c.default,{schema:a,FieldTemplate:i,onError:N("errors"),onSubmit:o,showErrorList:!1,liveValidate:!0,uiSchema:t},u.default.createElement("div",{className:"d-flex justify-content-between btns-forget-pwd"},u.default.createElement(b.default,{cta:{txt:"Annuler",class:"btn-light btn-block px-4",link:"/",visible:!0,tpl:"BtnBootstrapSubmit",type:"reset",onAction:function(){e.backToLogin()}}}),u.default.createElement("span",null," "),r&&u.default.createElement("div",{className:"m-auto text-center btn-block"},u.default.createElement("i",{className:"fas fa-spinner fa-pulse"}))||u.default.createElement(b.default,{cta:{txt:"Changer mon mot de passe",class:"btn-primary btn-block px-4",link:"/",visible:!0,tpl:"BtnBootstrapSubmit"}}))))}},{key:"renderInfoForgetPwd",value:function(){var e=this,t=this.state.successInfoForgetPwd;return u.default.createElement("div",null,u.default.createElement("div",{className:"alert alert-info"},t&&u.default.createElement("div",null,u.default.createElement("p",null,"Un email vous a été envoyé. Il contient un lien pour réinitialiser votre mot de passe.",u.default.createElement("br",null),"Ce lien n'est valable que 2 heures."),u.default.createElement("p",null,"Si vous n'avez pas reçu d'email, vérifiez vos spams ou recommencez la procédure.")),!t&&u.default.createElement("div",null,u.default.createElement("p",null,"Aucun compte ne correspond à cette adresse email"))),u.default.createElement("div",{className:"text-right"},u.default.createElement(b.default,{cta:{txt:"Retour",class:"btn-primary",link:"/",visible:!0,onAction:function(){e.backToLogin()}}})))}},{key:"renderNewPasswordSuccess",value:function(){var e=this;return u.default.createElement("div",null,u.default.createElement("h2",null," Changement du mot de passe "),u.default.createElement("br",null),u.default.createElement("div",{className:"alert alert-info"},u.default.createElement("p",null,"Votre mot de passe vient d'etre modifié."),u.default.createElement("p",null,"Vous pouvez desormais vous connecter.")),u.default.createElement("div",{className:"text-right"},this.state.pendingRequest&&u.default.createElement("i",{className:"fas fa-spinner fa-pulse"})||u.default.createElement(b.default,{cta:{txt:"Se connecter",class:"btn-success",link:"/",visible:!0,onAction:function(){e.backToLogin()}}})))}},{key:"renderNewPassword",value:function(){var e=this.props.uiSchema,t=this.state,n=t.schema4,a=t.pwdHasChanged,r=t.pendingRequest,o=this.doChangePwdValidation,i=this.CustomFieldTemplate,s=this.validateDoublePwd;return!a&&u.default.createElement("div",null,u.default.createElement("div",{className:"login__header"},"Mot de passe oublié"),u.default.createElement(c.default,{schema:n,FieldTemplate:i,onError:N("errors"),onSubmit:o,showErrorList:!1,liveValidate:!0,validate:s,uiSchema:e},u.default.createElement("div",{className:"text-center"},r&&u.default.createElement("i",{className:"fas fa-spinner fa-pulse"})||u.default.createElement(b.default,{cta:{txt:"Changer mon mot de passe",class:"btn-primary btn-block px-4",link:"/",visible:!0,tpl:"BtnBootstrapSubmit"}}))))||this.renderNewPasswordSuccess()}},{key:"render",value:function(){var e=this.state,t=e.loginForm,n=e.forgetPwdForm,a=e.showInfoForgetPwd,r=e.showNewPwdForm,o=e.token;return u.default.createElement(v.default,this.props,u.default.createElement("div",{className:"login__container"},r&&!o&&u.default.createElement("div",{className:"text-center"},u.default.createElement("div",null,u.default.createElement("strong",{className:"h4"},"Token expiré ou non valide")),u.default.createElement(b.default,{cta:{txt:"Retour à l'accueil",class:"btn-primary my-4",link:"/",visible:!0}})),r&&o&&this.renderNewPassword(),!r&&t&&!n&&this.renderLogin(),!r&&!t&&!n&&this.renderRegister(),!r&&n&&!a&&this.renderForgetPwd(),!r&&n&&a&&this.renderInfoForgetPwd()))}}]),t}(l.Component);C.defaultProps={prefixClass:"",loginRedirect:S+"://editor."+P+"/dashboard/",mode:"view",sectionCss:"",bg:{class:"bg-white",img:{path:"",class:""}},onLogin:function(){},master_mode:!1,startOn:"loginForm",loginForm:{type:"login",schema:{title:"",description:"",type:"object",required:["email","password"],properties:{email:{type:"string",format:"email",title:"Email"},password:{type:"string",title:"Mot de Passe",placeholder:"Mot de passe",minLength:5}}}},registerForm:{type:"register",schema:{title:"",description:"",type:"object",required:["email","password"],properties:{email:{type:"string",format:"email",title:"Email"},password:{type:"string",title:"Mot de Passe",minLength:5}}}},forgetPwdForm:{type:"forgetPwd",schema:{title:"",description:"",type:"object",required:["email"],properties:{email:{type:"string",format:"email",title:"Email"}}}},newPwdForm:{type:"newPwdForm",schema:{title:"",description:"",type:"object",required:["password","repeat_password"],properties:{password:{type:"string",title:"Mot de Passe",minLength:5},repeat_password:{type:"string",title:"Confirmation du mot de passe",minLength:5}}}},uiSchema:{email:{"ui:placeholder":"Courriel"},password:{"ui:placeholder":"Mot de passe","ui:widget":"password"},repeat_password:{"ui:placeholder":"Confirmation du mot de passe","ui:widget":"password"}}},t.default=C},function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t){e.exports=n},function(e,t){e.exports=a},function(e,t){e.exports=r},function(e,t){e.exports=o},function(e,t,n){var a=n(9);"string"==typeof a&&(a=[[e.i,a,""]]);n(11)(a,{});a.locals&&(e.exports=a.locals)},function(e,t,n){t=e.exports=n(10)(),t.push([e.i,".login__container{max-width:390px;margin:1rem auto}.login__header{text-align:center}.btns-forget-pwd{display:inline-flex}",""])},function(e,t,n){"use strict";e.exports=function(){var e=[];return e.toString=function(){for(var e=[],t=0;t<this.length;t++){var n=this[t];n[2]?e.push("@media "+n[2]+"{"+n[1]+"}"):e.push(n[1])}return e.join("")},e.i=function(t,n){"string"==typeof t&&(t=[[null,t,""]]);for(var a={},r=0;r<this.length;r++){var o=this[r][0];"number"==typeof o&&(a[o]=!0)}for(r=0;r<t.length;r++){var i=t[r];"number"==typeof i[0]&&a[i[0]]||(n&&!i[2]?i[2]=n:n&&(i[2]="("+i[2]+") and ("+n+")"),e.push(i))}},e}},function(e,t){function n(e,t){for(var n=0;n<e.length;n++){var a=e[n],r=f[a.id];if(r){r.refs++;for(var o=0;o<r.parts.length;o++)r.parts[o](a.parts[o]);for(;o<a.parts.length;o++)r.parts.push(l(a.parts[o],t))}else{for(var i=[],o=0;o<a.parts.length;o++)i.push(l(a.parts[o],t));f[a.id]={id:a.id,refs:1,parts:i}}}}function a(e){for(var t=[],n={},a=0;a<e.length;a++){var r=e[a],o=r[0],i=r[1],s=r[2],l=r[3],u={css:i,media:s,sourceMap:l};n[o]?n[o].parts.push(u):t.push(n[o]={id:o,parts:[u]})}return t}function r(e,t){var n=h(),a=w[w.length-1];if("top"===e.insertAt)a?a.nextSibling?n.insertBefore(t,a.nextSibling):n.appendChild(t):n.insertBefore(t,n.firstChild),w.push(t);else{if("bottom"!==e.insertAt)throw new Error("Invalid value for parameter 'insertAt'. Must be 'top' or 'bottom'.");n.appendChild(t)}}function o(e){e.parentNode.removeChild(e);var t=w.indexOf(e);t>=0&&w.splice(t,1)}function i(e){var t=document.createElement("style");return t.type="text/css",r(e,t),t}function s(e){var t=document.createElement("link");return t.rel="stylesheet",r(e,t),t}function l(e,t){var n,a,r;if(t.singleton){var l=v++;n=g||(g=i(t)),a=u.bind(null,n,l,!1),r=u.bind(null,n,l,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(n=s(t),a=c.bind(null,n),r=function(){o(n),n.href&&URL.revokeObjectURL(n.href)}):(n=i(t),a=d.bind(null,n),r=function(){o(n)});return a(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;a(e=t)}else r()}}function u(e,t,n,a){var r=n?"":a.css;if(e.styleSheet)e.styleSheet.cssText=b(t,r);else{var o=document.createTextNode(r),i=e.childNodes;i[t]&&e.removeChild(i[t]),i.length?e.insertBefore(o,i[t]):e.appendChild(o)}}function d(e,t){var n=t.css,a=t.media;if(a&&e.setAttribute("media",a),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}function c(e,t){var n=t.css,a=t.sourceMap;a&&(n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(a))))+" */");var r=new Blob([n],{type:"text/css"}),o=e.href;e.href=URL.createObjectURL(r),o&&URL.revokeObjectURL(o)}var f={},p=function(e){var t;return function(){return void 0===t&&(t=e.apply(this,arguments)),t}},m=p(function(){return/msie [6-9]\b/.test(self.navigator.userAgent.toLowerCase())}),h=p(function(){return document.head||document.getElementsByTagName("head")[0]}),g=null,v=0,w=[];e.exports=function(e,t){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");t=t||{},void 0===t.singleton&&(t.singleton=m()),void 0===t.insertAt&&(t.insertAt="bottom");var r=a(e);return n(r,t),function(e){for(var o=[],i=0;i<r.length;i++){var s=r[i],l=f[s.id];l.refs--,o.push(l)}if(e){n(a(e),t)}for(var i=0;i<o.length;i++){var l=o[i];if(0===l.refs){for(var u=0;u<l.parts.length;u++)l.parts[u]();delete f[l.id]}}}};var b=function(){var e=[];return function(t,n){return e[t]=n,e.filter(Boolean).join("\n")}}()}])});